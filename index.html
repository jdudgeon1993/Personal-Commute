<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Commute Dashboard</title>
<style>
    :root {
        --bg: #f3f3f7;
        --card: #ffffff;
        --text: #2b2b2b;
        --subtext: #666;
        --accent: #4a90e2;
        --accent-soft: rgba(74,144,226,0.12);
        --border: #e5e5e5;

        /* Dark theme */
        --bg-dark: #0f0f10;
        --card-dark: #1a1b1e;
        --text-dark: #ededed;
        --subtext-dark: #999;
        --border-dark: #2a2a2a;
    }

    body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text);
        transition: background 0.3s, color 0.3s;
    }
    body.dark {
        background: var(--bg-dark);
        color: var(--text-dark);
    }

    h2 {
        margin: 0;
        font-weight: 700;
        font-size: 1.35rem;
    }

    .container {
        max-width: 1100px;
        margin: auto;
        padding: 20px;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }
    @media (min-width: 800px) {
        .dashboard-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .card {
        position: relative;
        background: var(--card);
        border-radius: 14px;
        padding: 18px 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.07);
        border: 1px solid var(--border);
        transition: background 0.3s, border 0.3s;
    }
    body.dark .card {
        background: var(--card-dark);
        border: 1px solid var(--border-dark);
    }

    /* Right side status bar */
    .status-bar {
        position: absolute;
        top: 0;
        right: 0;
        width: 8px;
        height: 100%;
        border-radius: 0 14px 14px 0;
        background: gray; /* default */
    }

    /* Radio segmented control */
    .route-options {
        margin-top: 10px;
        display: flex;
        gap: 8px;
    }
    .route-options label {
        flex: 1;
        background: var(--accent-soft);
        padding: 8px 10px;
        border-radius: 8px;
        text-align: center;
        font-size: 0.9rem;
        cursor: pointer;
        transition: 0.25s;
        border: 1px solid transparent;
    }
    body.dark .route-options label {
        background: rgba(255,255,255,0.06);
    }
    .route-options input {
        display: none;
    }
    .route-options input:checked + label {
        background: var(--accent);
        color: white;
        border-color: rgba(0,0,0,0.15);
    }

    .section {
        margin-top: 16px;
        border-top: 1px solid var(--border);
        padding-top: 14px;
    }
    body.dark .section {
        border-color: var(--border-dark);
    }

    .row {
        display: flex;
        justify-content: space-between;
        margin: 6px 0;
    }

    .label {
        font-size: 0.9rem;
        color: var(--subtext);
    }
    body.dark .label {
        color: var(--subtext-dark);
    }

    .value {
        font-weight: 600;
    }

    /* Theme toggle */
    .theme-toggle {
        text-align: right;
        margin-bottom: 15px;
    }
    .theme-toggle button {
        padding: 8px 14px;
        border-radius: 8px;
        border: none;
        background: var(--accent);
        color: white;
        cursor: pointer;
        font-size: 0.9rem;
    }
</style>
</head>
<body>

<div class="container">

    <div class="theme-toggle">
        <button onclick="toggleTheme()">Toggle Theme</button>
    </div>

    <div class="dashboard-grid">

        <!-- DRIVE CARD -->
        <div class="card" id="driveCard">
            <div class="status-bar" id="driveStatus"></div>

            <h2>Drive</h2>

            <!-- Route options -->
            <div class="route-options">
                <input type="radio" name="route" id="fast" checked value="best">
                <label for="fast">Fastest Route</label>

                <input type="radio" name="route" id="noHighway" value="avoidHighways">
                <label for="noHighway">Avoid Highways</label>
            </div>

            <div class="section">
                <div class="label">To Work (Home → Downtown)</div>
                <div class="row">
                    <div class="label">ETA:</div>
                    <div class="value" id="driveToWork">Loading…</div>
                </div>
            </div>

            <div class="section">
                <div class="label">To Home (Downtown → Home)</div>
                <div class="row">
                    <div class="label">ETA:</div>
                    <div class="value" id="driveToHome">Loading…</div>
                </div>
            </div>
        </div>

        <!-- TRANSIT CARD -->
        <div class="card" id="transitCard">
            <div class="status-bar" id="transitStatus"></div>

            <h2>N Line Transit</h2>

            <div class="section">
                <div class="label">Southbound (112th → Union Station)</div>
                <div class="row">
                    <div class="label">Next Train:</div>
                    <div class="value" id="sbNext">Loading…</div>
                </div>
                <div class="row">
                    <div class="label">Countdown:</div>
                    <div class="value" id="sbCountdown">—</div>
                </div>
            </div>

            <div class="section">
                <div class="label">Northbound (Union Station → 112th)</div>
                <div class="row">
                    <div class="label">Next Train:</div>
                    <div class="value" id="nbNext">Loading…</div>
                </div>
                <div class="row">
                    <div class="label">Countdown:</div>
                    <div class="value" id="nbCountdown">—</div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
/* -------------------------------
   SETTINGS
-------------------------------- */
const WEATHER_API = "REPLACE_WITH_YOUR_OPENWEATHER_KEY";
const GOOGLE_KEY = "REPLACE_WITH_YOUR_GOOGLE_MAPS_KEY";

// Addresses
const home = "11625 Community Center Dr, Northglenn CO 80233";
const work = "707 17th St, Denver CO 80202";

const station112 = "112th & York Pkwy Station, Northglenn CO";
const union = "Denver Union Station, Denver CO";

/* -------------------------------
   THEME TOGGLE
-------------------------------- */
function toggleTheme() {
    document.body.classList.toggle("dark");
}

/* -------------------------------
   DRIVE TIME FETCHER
-------------------------------- */
async function fetchDrive(from, to, routingPref) {
    const avoid = routingPref === "avoidHighways" ? "&avoid=highways" : "";
    const url = `https://maps.googleapis.com/maps/api/directions/json?origin=${encodeURIComponent(from)}&destination=${encodeURIComponent(to)}${avoid}&departure_time=now&key=${GOOGLE_KEY}`;

    const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

    try {
        const r = await fetch(proxy);
        const data = await r.json();

        if (!data.routes || !data.routes[0] || !data.routes[0].legs) return null;

        return data.routes[0].legs[0].duration_in_traffic.text;
    } catch (e) {
        return null;
    }
}

/* -------------------------------
   TRANSIT TIME (Simplified Demo)
-------------------------------- */
function getFakeTrainTime(offsetMin) {
    const now = new Date();
    now.setMinutes(now.getMinutes() + offsetMin);
    return now;
}

function formatTime(d) {
    return d.toLocaleTimeString([], {hour: "numeric", minute:"2-digit"});
}

function countdown(d) {
    const diff = (d - new Date())/60000;
    return Math.max(0, diff).toFixed(0) + " min";
}

/* -------------------------------
   DRIVE + TRANSIT UPDATE
-------------------------------- */
async function updateDashboard() {
    const mode = document.querySelector("input[name='route']:checked").value;

    // DRIVE
    const toWork = await fetchDrive(home, work, mode);
    const toHome = await fetchDrive(work, home, mode);

    document.getElementById("driveToWork").textContent = toWork || "—";
    document.getElementById("driveToHome").textContent = toHome || "—";

    updateDriveStatusBar(toWork, toHome);

    // TRANSIT (Fake demo until GTFS or Maps Transit API is used)
    const sb = getFakeTrainTime(5);
    const nb = getFakeTrainTime(12);

    document.getElementById("sbNext").textContent = formatTime(sb);
    document.getElementById("nbNext").textContent = formatTime(nb);

    document.getElementById("sbCountdown").textContent = countdown(sb);
    document.getElementById("nbCountdown").textContent = countdown(nb);

    updateTransitStatusBar(sb, nb);
}

/* -------------------------------
   STATUS BAR COLOR LOGIC
-------------------------------- */
function updateDriveStatusBar(toWork, toHome) {
    const bar = document.getElementById("driveStatus");

    let val = toWork || toHome;
    if (!val) { bar.style.background = "gray"; return; }

    let mins = parseInt(val);
    if (mins < 25) bar.style.background = "green";
    else if (mins < 40) bar.style.background = "yellow";
    else bar.style.background = "red";
}

function updateTransitStatusBar(sb, nb) {
    const bar = document.getElementById("transitStatus");
    const soonest = sb < nb ? sb : nb;

    const mins = (soonest - new Date()) / 60000;

    if (mins < 7) bar.style.background = "green";
    else if (mins < 12) bar.style.background = "yellow";
    else bar.style.background = "red";
}

/* -------------------------------
   AUTO-REFRESH
-------------------------------- */
setInterval(updateDashboard, 600000); // 10 min
updateDashboard();

/* On toggle radio update */
document.querySelectorAll("input[name='route']").forEach(el => {
    el.addEventListener("change", updateDashboard);
});
</script>

</body>
</html>