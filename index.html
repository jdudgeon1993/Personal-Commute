<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Taskify Commute Dashboard - Real-time commute information">
  <meta name="theme-color" content="#1e293b">
  <title>Taskify || Commute Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    *:focus-visible {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }
    /* Fixed bottom navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 50;
      padding-bottom: env(safe-area-inset-bottom);
    }
    /* Content area with bottom padding for nav */
    .content-area {
      padding-bottom: 100px;
    }
    /* Smooth scroll */
    html {
      scroll-behavior: smooth;
    }
    /* Loading skeleton */
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    .skeleton {
      animation: shimmer 2s infinite;
      background: linear-gradient(to right, #f0f0f0 4%, #f8f8f8 25%, #f0f0f0 36%);
      background-size: 1000px 100%;
    }
    .skeleton-dark {
      animation: shimmer 2s infinite;
      background: linear-gradient(to right, #374151 4%, #4b5563 25%, #374151 36%);
      background-size: 1000px 100%;
    }

    /* Glowing station animations for train arrivals/departures */
    @keyframes glow-arriving {
      0%, 100% {
        box-shadow: 0 0 5px currentColor,
                    0 0 10px currentColor,
                    0 0 15px currentColor;
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 10px currentColor,
                    0 0 20px currentColor,
                    0 0 30px currentColor;
        transform: scale(1.1);
      }
    }

    @keyframes glow-departing {
      0%, 100% {
        box-shadow: 0 0 3px currentColor,
                    0 0 6px currentColor,
                    0 0 9px currentColor;
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 6px currentColor,
                    0 0 12px currentColor,
                    0 0 18px currentColor;
        transform: scale(1.05);
      }
    }

    .station-glow-arriving {
      animation: glow-arriving 1.5s ease-in-out infinite;
    }

    .station-glow-departing {
      animation: glow-departing 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    /**
     * Taskify Commute Dashboard - Redesigned with Bottom Navigation
     *
     * FEATURES:
     * - Bottom navigation bar (like Personal Calendar app)
     * - Content hidden until section is clicked
     * - Address-based search (not lat/lng)
     * - 15-minute unified refresh interval
     * - Weather integration in header
     * - Clean, mobile-first layout
     */

    const { useState, useEffect, useCallback } = React;

    // Constants
    const CONSTANTS = {
      REFRESH_INTERVAL: 900000, // 15 minutes
      CLOCK_INTERVAL: 1000, // 1 second for clock
      TRANSIT_INTERVAL: 60000, // 1 minute for transit (needs more frequent updates)
      API_BASE_URL: window.location.origin // Use same origin for API calls
    };

    const config = {
      locations: {
        home: { lat: 39.9066611, lng: -104.987454 },
        garage: { lat: 39.747676849365234, lng: -104.9898452758789 },
        work: { lat: 39.74645233154297, lng: -104.99141693115234 }
      },
      weather: {
        lat: 39.8858,
        lon: -104.9872
      },
      // N Line: All stations from south to north
      nLineStops: {
        unionStation: '34667',     // Terminal - Track 1 (southbound endpoint)
        station112th: '34668',     // Middle - 112th Ave (your boarding point)
        terminal124th: '35367'     // Terminal - Eastlake/124th Ave (northbound endpoint)
      },
      // Legacy N Line stops (keep for backwards compatibility during migration)
      rtdStops: {
        southbound: '35254',
        northbound: '34668'
      },
      // G Line: All stations from west to east
      gLineStops: {
        oldeTown: '33833',         // Terminal - Olde Town Arvada (westbound endpoint)
        goldStrike: '34525',       // Middle - 60th/Sheridan Gold Strike
        pecosJunction: '34508',    // Middle - Transfer point (shared with B Line)
        unionStation: '34781'      // Terminal - Track 7 (eastbound endpoint)
      },
      // B Line: All stations from south to north
      bLineStops: {
        unionStation: '34782',     // Terminal - Track 8 (southbound endpoint)
        pecosJunction: '34508',    // Middle - Transfer point (shared with G Line)
        westminster: '34767'       // Terminal - Westminster (northbound endpoint)
      }
    };

    const CommuteDashboard = () => {
      // State
      const [currentTime, setCurrentTime] = useState(new Date());
      const [activeSection, setActiveSection] = useState('drive'); // drive, nline, bus, search
      const [weather, setWeather] = useState(null);
      const [driveData, setDriveData] = useState(null);
      const [transitDataSB, setTransitDataSB] = useState(null);
      const [transitDataNB, setTransitDataNB] = useState(null);
      const [gLineEastbound, setGLineEastbound] = useState(null); // Trains going to Union Station
      const [gLineWestbound, setGLineWestbound] = useState(null); // Trains going to Olde Town
      const [bLineSouthbound, setBLineSouthbound] = useState(null); // Trains going to Union Station
      const [bLineNorthbound, setBLineNorthbound] = useState(null); // Trains going to Westminster
      const [searchFromAddress, setSearchFromAddress] = useState('');
      const [searchToAddress, setSearchToAddress] = useState('');
      const [searchResults, setSearchResults] = useState(null);
      const [avoidHighways, setAvoidHighways] = useState(false);
      const [isDarkMode, setIsDarkMode] = useState(() => {
        try {
          const saved = localStorage.getItem('darkMode');
          return saved !== null ? JSON.parse(saved) : true;
        } catch (e) {
          return true;
        }
      });
      const [loading, setLoading] = useState({
        weather: true,
        drive: true,
        transit: true,
        gLine: true,
        bLine: true,
        search: false
      });
      const [visibleLines, setVisibleLines] = useState({
        nLine: true,
        gLine: true,
        bLine: true
      });

      // Station-based state for multi-station app
      const [nLineData, setNLineData] = useState({
        terminal124th: { arriving: [], departing: [] },
        station112th: { northbound: [], southbound: [] },
        unionStation: { arriving: [], departing: [] }
      });

      const [gLineData, setGLineData] = useState({
        oldeTown: { arriving: [], departing: [] },
        goldStrike: { eastbound: [], westbound: [] },
        pecosJunction: { eastbound: [], westbound: [] },
        unionStation: { arriving: [], departing: [] }
      });

      const [bLineData, setBLineData] = useState({
        westminster: { arriving: [], departing: [] },
        pecosJunction: { northbound: [], southbound: [] },
        unionStation: { arriving: [], departing: [] }
      });

      const [expandedStations, setExpandedStations] = useState({
        nLine: { terminal124th: false, station112th: true, unionStation: false },
        gLine: { oldeTown: false, goldStrike: true, pecosJunction: false, unionStation: false },
        bLine: { westminster: false, pecosJunction: true, unionStation: false }
      });

      const [isInitialLoad, setIsInitialLoad] = useState(true);
      const [lastRefresh, setLastRefresh] = useState(new Date());
      const [refreshSuccess, setRefreshSuccess] = useState(false);

      // Check if initial load is complete
      useEffect(() => {
        if (!loading.weather && !loading.drive && !loading.transit && isInitialLoad) {
          // Small delay for smooth transition
          setTimeout(() => setIsInitialLoad(false), 500);
        }
      }, [loading.weather, loading.drive, loading.transit, isInitialLoad]);

      // Save dark mode preference
      useEffect(() => {
        try {
          localStorage.setItem('darkMode', JSON.stringify(isDarkMode));
        } catch (e) {
          console.error('Error saving darkMode:', e);
        }
      }, [isDarkMode]);

      // Greeting logic - simple time-based greeting
      const getGreeting = () => {
        const hour = currentTime.getHours();
        const day = currentTime.getDay();
        const isWeekend = day === 0 || day === 6;

        let timeGreeting = hour < 12 ? 'Good Morning' : 'Good Evening';
        let contextGreeting = isWeekend ? 'Enjoy your Weekend' : 'Have a great Workday';

        return { timeGreeting, contextGreeting, isWeekend };
      };

      const greeting = getGreeting();

      // Clock update (every second)
      useEffect(() => {
        const interval = setInterval(() => {
          setCurrentTime(new Date());
        }, CONSTANTS.CLOCK_INTERVAL);
        return () => clearInterval(interval);
      }, []);

      // Fetch weather
      const fetchWeather = useCallback(async () => {
        try {
          setLoading(prev => ({ ...prev, weather: true }));
          const response = await fetch(
            `${CONSTANTS.API_BASE_URL}/api/weather?lat=${config.weather.lat}&lon=${config.weather.lon}`
          );
          const data = await response.json();
          setWeather(data);
        } catch (error) {
          console.error('Weather error:', error);
          setWeather({
            main: { temp: 72, feels_like: 70, humidity: 50 },
            weather: [{ description: 'clear sky', icon: '01d' }],
            wind: { speed: 5 },
            _isFallback: true
          });
        } finally {
          setLoading(prev => ({ ...prev, weather: false }));
        }
      }, []);

      // Fetch drive times
      const fetchDriveTimes = useCallback(async () => {
        try {
          setLoading(prev => ({ ...prev, drive: true }));
          const routingPreference = avoidHighways ? 'TRAFFIC_AWARE_OPTIMAL' : 'TRAFFIC_AWARE';

          const morningRoute = {
            origin: { location: { latLng: { latitude: config.locations.home.lat, longitude: config.locations.home.lng }}},
            destination: { location: { latLng: { latitude: config.locations.garage.lat, longitude: config.locations.garage.lng }}},
            travelMode: 'DRIVE',
            routingPreference: routingPreference,
            ...(avoidHighways && { routeModifiers: { avoidHighways: true }}),
            computeAlternativeRoutes: false,
            languageCode: 'en-US',
            units: 'IMPERIAL'
          };

          const eveningRoute = {
            origin: { location: { latLng: { latitude: config.locations.garage.lat, longitude: config.locations.garage.lng }}},
            destination: { location: { latLng: { latitude: config.locations.home.lat, longitude: config.locations.home.lng }}},
            travelMode: 'DRIVE',
            routingPreference: routingPreference,
            ...(avoidHighways && { routeModifiers: { avoidHighways: true }}),
            computeAlternativeRoutes: false,
            languageCode: 'en-US',
            units: 'IMPERIAL'
          };

          const walkRoute = {
            origin: { location: { latLng: { latitude: config.locations.garage.lat, longitude: config.locations.garage.lng }}},
            destination: { location: { latLng: { latitude: config.locations.work.lat, longitude: config.locations.work.lng }}},
            travelMode: 'WALK',
            computeAlternativeRoutes: false,
            languageCode: 'en-US',
            units: 'IMPERIAL'
          };

          const [morningRes, eveningRes, walkRes] = await Promise.all([
            fetch(`${CONSTANTS.API_BASE_URL}/api/routes`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'X-Goog-FieldMask': 'routes.duration,routes.distanceMeters,routes.staticDuration' },
              body: JSON.stringify(morningRoute)
            }),
            fetch(`${CONSTANTS.API_BASE_URL}/api/routes`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'X-Goog-FieldMask': 'routes.duration,routes.distanceMeters,routes.staticDuration' },
              body: JSON.stringify(eveningRoute)
            }),
            fetch(`${CONSTANTS.API_BASE_URL}/api/routes`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'X-Goog-FieldMask': 'routes.duration,routes.distanceMeters,routes.staticDuration' },
              body: JSON.stringify(walkRoute)
            })
          ]);

          const morningData = await morningRes.json();
          const eveningData = await eveningRes.json();
          const walkData = await walkRes.json();

          if (morningData.routes && morningData.routes.length > 0) {
            const morningDuration = parseInt(morningData.routes[0].duration.replace('s', ''));
            const morningDistance = morningData.routes[0].distanceMeters;
            const eveningDuration = parseInt(eveningData.routes[0].duration.replace('s', ''));
            const eveningDistance = eveningData.routes[0].distanceMeters;
            const walkDuration = parseInt(walkData.routes[0].duration.replace('s', ''));
            const walkDistance = walkData.routes[0].distanceMeters;

            setDriveData({
              morning: {
                duration: { text: `${Math.round(morningDuration / 60)} mins`, value: morningDuration },
                distance: { text: `${(morningDistance * 0.000621371).toFixed(1)} mi` }
              },
              evening: {
                duration: { text: `${Math.round(eveningDuration / 60)} mins`, value: eveningDuration },
                distance: { text: `${(eveningDistance * 0.000621371).toFixed(1)} mi` }
              },
              walk: {
                duration: { text: `${Math.round(walkDuration / 60)} mins`, value: walkDuration },
                distance: { text: `${(walkDistance * 0.000621371).toFixed(1)} mi` }
              }
            });
          } else {
            throw new Error('No routes returned');
          }
        } catch (error) {
          console.error('Drive time error:', error);
          setDriveData({
            morning: { duration: { text: '30 mins', value: 1800 }, distance: { text: '14.2 mi' }},
            evening: { duration: { text: '30 mins', value: 1800 }, distance: { text: '14.2 mi' }},
            walk: { duration: { text: '8 mins', value: 480 }, distance: { text: '0.4 mi' }},
            _isFallback: true
          });
        } finally {
          setLoading(prev => ({ ...prev, drive: false }));
        }
      }, [avoidHighways]);

      // Helper: Process train data from API response
      const processTrainData = (arrivals, routeId, directionId, useArrival = true) => {
        if (!arrivals || !Array.isArray(arrivals) || arrivals.length === 0) {
          console.log(`‚ö†Ô∏è processTrainData: No arrivals data for route ${routeId} dir ${directionId}`);
          return [];
        }

        const filtered = arrivals.filter(arrival => {
          const matchesRoute = arrival.routeId === routeId;
          const matchesDirection = directionId === null || arrival.directionId === directionId;
          return matchesRoute && matchesDirection;
        });

        console.log(`üîç processTrainData: Route ${routeId} dir ${directionId} - Found ${filtered.length}/${arrivals.length} matching trains`);

        return filtered.slice(0, 3).map(arrival => {
          let arrivalTimestamp = null;
          let displayTime = null;
          let delayMinutes = 0;

          // Use arrival time or departure time based on station type
          const timeValue = useArrival ?
            (arrival.arrivalTime || arrival.departureTime) :
            (arrival.departureTime || arrival.arrivalTime);

          const timeFormatted = useArrival ?
            (arrival.arrivalTimeFormatted || arrival.departureTimeFormatted) :
            (arrival.departureTimeFormatted || arrival.arrivalTimeFormatted);

          if (timeValue && typeof timeValue === 'number') {
            arrivalTimestamp = timeValue * 1000;
            displayTime = timeFormatted;

            if (arrival.scheduledArrivalTime && typeof arrival.scheduledArrivalTime === 'number') {
              const scheduledTimestamp = arrival.scheduledArrivalTime * 1000;
              delayMinutes = Math.round((arrivalTimestamp - scheduledTimestamp) / 60000);
            }
          } else {
            displayTime = timeFormatted;
          }

          return {
            time: displayTime,
            arrivalTimestamp: arrivalTimestamp,
            delay: delayMinutes,
            status: arrival.status || 'On Time',
            isDeparture: !useArrival,
            tripId: arrival.tripId
          };
        });
      };

      // Helper: Process terminal station (shows both arriving and departing trains)
      const processTerminalStation = (arrivals, routeId, inboundDir, outboundDir) => {
        const arriving = processTrainData(arrivals, routeId, inboundDir, true);
        const departing = processTrainData(arrivals, routeId, outboundDir, false);

        console.log(`üöâ Terminal station - Route ${routeId}: ${arriving.length} arriving (dir ${inboundDir}), ${departing.length} departing (dir ${outboundDir})`);
        console.log(`   Total arrivals in API response: ${arrivals?.length || 0}`);

        return {
          arriving: arriving,
          departing: departing
        };
      };

      // Helper: Process middle station (shows trains passing through in both directions)
      const processMiddleStation = (arrivals, routeId, dir1, dir2, dir1Name, dir2Name) => {
        const dir1Trains = processTrainData(arrivals, routeId, dir1, true);
        const dir2Trains = processTrainData(arrivals, routeId, dir2, true);

        console.log(`üìç Middle station - ${dir1Name}: ${dir1Trains.length} trains, ${dir2Name}: ${dir2Trains.length} trains`);

        return {
          [dir1Name]: dir1Trains,
          [dir2Name]: dir2Trains
        };
      };

      // Helper: Determine if a station should glow based on train arrivals/departures
      // Returns: { glow: boolean, type: 'arriving' | 'departing' | null }
      const getStationGlow = (stationData, isTerminal = false) => {
        const now = currentTime.getTime();
        const ARRIVAL_GLOW_WINDOW = 15 * 1000; // 15 seconds before arrival
        const DEPARTURE_GLOW_WINDOW = 7 * 1000; // 7 seconds after departure

        // For terminal stations: check both arriving and departing trains
        if (isTerminal) {
          // Check arriving trains (glow 15 seconds before arrival)
          const arrivingTrains = stationData.arriving || [];
          for (const train of arrivingTrains) {
            if (train.arrivalTimestamp) {
              const timeUntilArrival = train.arrivalTimestamp - now;
              if (timeUntilArrival > 0 && timeUntilArrival <= ARRIVAL_GLOW_WINDOW) {
                return { glow: true, type: 'arriving' };
              }
            }
          }

          // Check departing trains (glow 7 seconds after departure)
          const departingTrains = stationData.departing || [];
          for (const train of departingTrains) {
            if (train.arrivalTimestamp) {
              const timeSinceDeparture = now - train.arrivalTimestamp;
              if (timeSinceDeparture > 0 && timeSinceDeparture <= DEPARTURE_GLOW_WINDOW) {
                return { glow: true, type: 'departing' };
              }
            }
          }
        } else {
          // For middle stations: check all directional trains for arrivals
          const allTrains = Object.values(stationData).flat();
          for (const train of allTrains) {
            if (train.arrivalTimestamp) {
              const timeUntilArrival = train.arrivalTimestamp - now;
              if (timeUntilArrival > 0 && timeUntilArrival <= ARRIVAL_GLOW_WINDOW) {
                return { glow: true, type: 'arriving' };
              }
            }
          }
        }

        return { glow: false, type: null };
      };

      // Fetch N Line data from all stations (multi-stop parallel fetch)
      const fetchTransitData = useCallback(async () => {
        try {
          setLoading(prev => ({ ...prev, transit: true }));
          const apiEndpoint = 'https://rtd-n-line-api.onrender.com/api/rtd/arrivals';

          console.log('üöÜ Fetching N Line data from all 3 stations...');

          // Fetch all 3 N Line stations in parallel
          const [terminal124thRes, station112thRes, unionRes] = await Promise.all([
            fetch(`${apiEndpoint}/${config.nLineStops.terminal124th}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.nLineStops.station112th}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.nLineStops.unionStation}?t=${Date.now()}`).then(r => r.json())
          ]);

          console.log('‚úÖ All N Line stations fetched');

          // Process 124th Station (Terminal - northbound endpoint)
          // Shows trains arriving from south (dir 1 southbound) and departing to south (dir 0 northbound)
          const terminal124thData = processTerminalStation(
            terminal124thRes.arrivals,
            '117N',
            0,  // arriving from south (northbound trains ending at 124th)
            1   // departing to south (southbound trains starting from 124th to Union)
          );

          // Process 112th Station (Middle - user's boarding point)
          // Shows trains in both directions
          const station112thData = processMiddleStation(
            station112thRes.arrivals,
            '117N',
            0,  // northbound (to 124th)
            1,  // southbound (to Union)
            'northbound',
            'southbound'
          );

          // Process Union Station (Terminal - southbound endpoint)
          // Shows trains arriving from north (dir 0 northbound) and departing to north (dir 1 southbound)
          const unionData = processTerminalStation(
            unionRes.arrivals,
            '117N',
            1,  // arriving from north (southbound trains ending at Union)
            0   // departing to north (northbound trains starting from Union to 124th)
          );

          // Update station-based state
          setNLineData({
            terminal124th: terminal124thData,
            station112th: station112thData,
            unionStation: unionData
          });

          // Maintain backwards compatibility with old state (for now)
          setTransitDataSB(terminal124thData.departing);  // Departures from 124th to Union (southbound)
          setTransitDataNB(unionData.departing);  // Departures from Union to 124th (northbound)

          console.log('üéØ N Line station data processed:', {
            terminal124th: terminal124thData,
            station112th: station112thData,
            unionStation: unionData
          });

        } catch (error) {
          console.error('‚ùå N Line error:', error);
          setTransitDataSB([]);
          setTransitDataNB([]);
          setNLineData({
            terminal124th: { arriving: [], departing: [] },
            station112th: { northbound: [], southbound: [] },
            unionStation: { arriving: [], departing: [] }
          });
        } finally {
          setLoading(prev => ({ ...prev, transit: false }));
        }
      }, []);

      // Fetch G Line data from all stations (multi-stop parallel fetch)
      const fetchGLineData = useCallback(async () => {
        try {
          setLoading(prev => ({ ...prev, gLine: true }));
          const apiEndpoint = `${CONSTANTS.API_BASE_URL}/api/rtd/gline`;

          console.log('üöÜ Fetching G Line data from all 4 stations...');

          // Fetch all 4 G Line stations in parallel
          const [oldeTownRes, goldStrikeRes, pecosRes, unionRes] = await Promise.all([
            fetch(`${apiEndpoint}/${config.gLineStops.oldeTown}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.gLineStops.goldStrike}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.gLineStops.pecosJunction}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.gLineStops.unionStation}?t=${Date.now()}`).then(r => r.json())
          ]);

          console.log('‚úÖ All G Line stations fetched');

          // Process Olde Town Station (Terminal - westbound endpoint)
          // Shows trains arriving from east (dir 0) and departing to east (dir 1)
          const oldeTownData = processTerminalStation(
            oldeTownRes.arrivals,
            '113G',
            1,  // arriving from east (eastbound trains ending here)
            0   // departing to east (westbound trains starting here)
          );

          // Process Gold Strike Station (Middle - pass-through)
          // Shows trains in both directions
          const goldStrikeData = processMiddleStation(
            goldStrikeRes.arrivals,
            '113G',
            0,  // westbound (to Olde Town)
            1,  // eastbound (to Union Station)
            'westbound',
            'eastbound'
          );

          // Process Pecos Junction (Middle - transfer point)
          // Shows trains in both directions
          const pecosData = processMiddleStation(
            pecosRes.arrivals,
            '113G',
            0,  // westbound (to Olde Town)
            1,  // eastbound (to Union Station)
            'westbound',
            'eastbound'
          );

          // Process Union Station (Terminal - eastbound endpoint)
          // Shows trains arriving from west (dir 1 eastbound) and departing to west (dir 0 westbound)
          const unionData = processTerminalStation(
            unionRes.arrivals,
            '113G',
            1,  // arriving from west (eastbound trains ending at Union)
            0   // departing to west (westbound trains starting from Union to Olde Town)
          );

          // Update station-based state
          setGLineData({
            oldeTown: oldeTownData,
            goldStrike: goldStrikeData,
            pecosJunction: pecosData,
            unionStation: unionData
          });

          // Maintain backwards compatibility with old state (for now)
          setGLineWestbound(unionData.departing);  // Departures from Union to Olde Town
          setGLineEastbound(oldeTownData.departing);  // Departures from Olde Town to Union

          console.log('üéØ G Line station data processed:', {
            oldeTown: oldeTownData,
            goldStrike: goldStrikeData,
            pecosJunction: pecosData,
            unionStation: unionData
          });

        } catch (error) {
          console.error('‚ùå G Line error:', error);
          setGLineEastbound([]);
          setGLineWestbound([]);
          setGLineData({
            oldeTown: { arriving: [], departing: [] },
            goldStrike: { eastbound: [], westbound: [] },
            pecosJunction: { eastbound: [], westbound: [] },
            unionStation: { arriving: [], departing: [] }
          });
        } finally {
          setLoading(prev => ({ ...prev, gLine: false }));
        }
      }, []);

      // Fetch B Line data from all stations (multi-stop parallel fetch)
      const fetchBLineData = useCallback(async () => {
        try {
          setLoading(prev => ({ ...prev, bLine: true }));
          const apiEndpoint = `${CONSTANTS.API_BASE_URL}/api/rtd/gline`;

          console.log('üöÜ Fetching B Line data from all 3 stations...');

          // Fetch all 3 B Line stations in parallel
          const [westminsterRes, pecosRes, unionRes] = await Promise.all([
            fetch(`${apiEndpoint}/${config.bLineStops.westminster}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.bLineStops.pecosJunction}?t=${Date.now()}`).then(r => r.json()),
            fetch(`${apiEndpoint}/${config.bLineStops.unionStation}?t=${Date.now()}`).then(r => r.json())
          ]);

          console.log('‚úÖ All B Line stations fetched');

          // Process Westminster Station (Terminal - northbound endpoint)
          // Shows trains arriving from south (dir 1 southbound) and departing to south (dir 0 northbound)
          const westminsterData = processTerminalStation(
            westminsterRes.arrivals,
            '113B',
            0,  // arriving from south (northbound trains ending at Westminster)
            1   // departing to south (southbound trains starting from Westminster to Union)
          );

          // Process Pecos Junction (Middle - transfer point)
          // Shows trains in both directions
          const pecosData = processMiddleStation(
            pecosRes.arrivals,
            '113B',
            0,  // northbound (to Westminster)
            1,  // southbound (to Union Station)
            'northbound',
            'southbound'
          );

          // Process Union Station (Terminal - southbound endpoint)
          // Shows trains arriving from north (dir 0 northbound) and departing to north (dir 1 southbound)
          const unionData = processTerminalStation(
            unionRes.arrivals,
            '113B',
            1,  // arriving from north (southbound trains ending at Union)
            0   // departing to north (northbound trains starting from Union to Westminster)
          );

          // Update station-based state
          setBLineData({
            westminster: westminsterData,
            pecosJunction: pecosData,
            unionStation: unionData
          });

          // Maintain backwards compatibility with old state (for now)
          setBLineNorthbound(unionData.departing);  // Departures from Union to Westminster
          setBLineSouthbound(westminsterData.departing);  // Departures from Westminster to Union

          console.log('üéØ B Line station data processed:', {
            westminster: westminsterData,
            pecosJunction: pecosData,
            unionStation: unionData
          });

        } catch (error) {
          console.error('‚ùå B Line error:', error);
          setBLineSouthbound([]);
          setBLineNorthbound([]);
          setBLineData({
            westminster: { arriving: [], departing: [] },
            pecosJunction: { northbound: [], southbound: [] },
            unionStation: { arriving: [], departing: [] }
          });
        } finally {
          setLoading(prev => ({ ...prev, bLine: false }));
        }
      }, []);

      // Geocode address to coordinates
      const geocodeAddress = async (address) => {
        const response = await fetch(
          `${CONSTANTS.API_BASE_URL}/api/geocode?address=${encodeURIComponent(address)}`
        );
        const data = await response.json();

        if (data.results && data.results.length > 0) {
          const location = data.results[0].geometry.location;
          return { lat: location.lat, lng: location.lng };
        }
        throw new Error('Address not found');
      };

      // Search location drive times with addresses
      const searchDriveTimes = useCallback(async () => {
        if (!searchFromAddress || !searchToAddress) return;

        try {
          setLoading(prev => ({ ...prev, search: true }));
          setSearchResults(null);

          // Geocode both addresses
          const fromCoords = await geocodeAddress(searchFromAddress);
          const toCoords = await geocodeAddress(searchToAddress);

          const routeWithHighway = {
            origin: { location: { latLng: { latitude: fromCoords.lat, longitude: fromCoords.lng }}},
            destination: { location: { latLng: { latitude: toCoords.lat, longitude: toCoords.lng }}},
            travelMode: 'DRIVE',
            routingPreference: 'TRAFFIC_AWARE',
            computeAlternativeRoutes: false,
            languageCode: 'en-US',
            units: 'IMPERIAL'
          };

          const routeNoHighway = {
            ...routeWithHighway,
            routeModifiers: { avoidHighways: true }
          };

          const [withHighwayRes, noHighwayRes] = await Promise.all([
            fetch(`${CONSTANTS.API_BASE_URL}/api/routes`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'X-Goog-FieldMask': 'routes.duration,routes.distanceMeters' },
              body: JSON.stringify(routeWithHighway)
            }),
            fetch(`${CONSTANTS.API_BASE_URL}/api/routes`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'X-Goog-FieldMask': 'routes.duration,routes.distanceMeters' },
              body: JSON.stringify(routeNoHighway)
            })
          ]);

          const withHighwayData = await withHighwayRes.json();
          const noHighwayData = await noHighwayRes.json();

          if (withHighwayData.routes && withHighwayData.routes.length > 0) {
            const withHighwayDuration = parseInt(withHighwayData.routes[0].duration.replace('s', ''));
            const withHighwayDistance = withHighwayData.routes[0].distanceMeters;
            const noHighwayDuration = parseInt(noHighwayData.routes[0].duration.replace('s', ''));
            const noHighwayDistance = noHighwayData.routes[0].distanceMeters;

            setSearchResults({
              withHighway: {
                durationMinutes: Math.round(withHighwayDuration / 60),
                distance: `${(withHighwayDistance * 0.000621371).toFixed(1)} mi`
              },
              noHighway: {
                durationMinutes: Math.round(noHighwayDuration / 60),
                distance: `${(noHighwayDistance * 0.000621371).toFixed(1)} mi`
              }
            });
          }
        } catch (error) {
          console.error('Search error:', error);
          setSearchResults({ error: error.message || 'Unable to calculate route' });
        } finally {
          setLoading(prev => ({ ...prev, search: false }));
        }
      }, [searchFromAddress, searchToAddress]);

      // Initial data fetch
      useEffect(() => {
        fetchWeather();
        fetchDriveTimes();
        fetchTransitData();
        fetchGLineData();
        fetchBLineData();
      }, [fetchWeather, fetchDriveTimes, fetchTransitData, fetchGLineData, fetchBLineData]);

      // 15-minute refresh for weather and drive times
      useEffect(() => {
        const interval = setInterval(() => {
          fetchWeather();
          fetchDriveTimes();
          setLastRefresh(new Date());
        }, CONSTANTS.REFRESH_INTERVAL);
        return () => clearInterval(interval);
      }, [fetchWeather, fetchDriveTimes]);

      // 1-minute refresh for transit (needs more frequent updates)
      useEffect(() => {
        const interval = setInterval(() => {
          fetchTransitData();
          fetchGLineData();
          fetchBLineData();
        }, CONSTANTS.TRANSIT_INTERVAL);
        return () => clearInterval(interval);
      }, [fetchTransitData, fetchGLineData, fetchBLineData]);

      // Manual refresh all with success feedback
      const handleManualRefresh = () => {
        fetchWeather();
        fetchDriveTimes();
        fetchTransitData();
        fetchGLineData();
        fetchBLineData();
        setLastRefresh(new Date());
        setRefreshSuccess(true);
        setTimeout(() => setRefreshSuccess(false), 2000);
      };

      // Scroll to top when changing sections
      useEffect(() => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, [activeSection]);

      // Helper function to format duration
      const formatDuration = (minutes) => {
        if (minutes >= 60) {
          const hours = Math.floor(minutes / 60);
          const mins = minutes % 60;
          if (mins === 0) return `${hours} hr`;
          return `${hours} hr ${mins} min`;
        }
        return `${minutes} mins`;
      };

      // Theme colors
      const theme = isDarkMode
        ? 'from-gray-900 to-gray-800 text-white'
        : 'from-gray-50 to-gray-100 text-gray-900';
      const cardBg = isDarkMode ? 'bg-gray-800' : 'bg-white';
      const textColor = isDarkMode ? 'text-white' : 'text-gray-900';
      const textMuted = isDarkMode ? 'text-gray-400' : 'text-gray-600';
      const borderColor = isDarkMode ? 'border-gray-700' : 'border-gray-200';

      // Render train card with real-time countdown
      const renderTrainCard = (train, idx, type = 'arrival') => {
        if (!train.arrivalTimestamp) return null;

        // Use currentTime for real-time countdown (updates every second)
        const now = currentTime.getTime();
        const totalSecondsUntil = Math.floor((train.arrivalTimestamp - now) / 1000);
        const minutesUntil = Math.floor(totalSecondsUntil / 60);
        const secondsUntil = totalSecondsUntil % 60;

        let urgencyColor = isDarkMode ? 'bg-gray-700' : 'bg-gray-100';
        if (minutesUntil <= 5) urgencyColor = isDarkMode ? 'bg-red-900 bg-opacity-30' : 'bg-red-50';
        else if (minutesUntil <= 10) urgencyColor = isDarkMode ? 'bg-orange-900 bg-opacity-30' : 'bg-orange-50';
        else if (minutesUntil <= 15) urgencyColor = isDarkMode ? 'bg-yellow-900 bg-opacity-30' : 'bg-yellow-50';

        let delayColor = 'bg-green-100 text-green-700';
        if (train.delay > 3) delayColor = 'bg-red-100 text-red-700';
        else if (train.delay > 0) delayColor = 'bg-yellow-100 text-yellow-700';

        // Format countdown display with minutes and seconds
        let countdownDisplay;
        if (totalSecondsUntil < 0) {
          countdownDisplay = type === 'departure' ? 'Departed' : 'Arrived';
        } else if (totalSecondsUntil < 60) {
          countdownDisplay = `${totalSecondsUntil} sec`;
        } else {
          countdownDisplay = `${minutesUntil} min ${secondsUntil} sec`;
        }

        // Arrival vs Departure indicator
        const typeIndicator = type === 'departure' ? 'üöÄ' : 'üöÜ';
        const typeLabel = type === 'departure' ? 'Departs' : 'Arrives';

        return (
          <div key={idx} className={`p-4 rounded-xl ${urgencyColor} border ${borderColor}`}>
            <div className="flex justify-between items-center">
              <div className="flex-1">
                <div className="flex items-center gap-2 mb-1">
                  <span>{typeIndicator}</span>
                  <span className={`text-xs font-semibold ${textMuted}`}>{typeLabel}</span>
                </div>
                <p className={`text-2xl font-bold ${textColor}`}>
                  {countdownDisplay}
                </p>
                <p className={`text-sm ${textMuted}`}>{train.time}</p>
              </div>
              <div className="text-right">
                <span className={`px-2 py-1 rounded text-xs font-semibold ${delayColor}`}>
                  {train.delay > 0 ? `+${train.delay} min` : 'On Time'}
                </span>
              </div>
            </div>
          </div>
        );
      };

      // StationCard Component: Renders a station with expand/collapse and trains
      const renderStationCard = (stationName, stationData, line, stationKey, isTerminal = false) => {
        const isExpanded = expandedStations[line][stationKey];

        const toggleExpand = () => {
          setExpandedStations(prev => ({
            ...prev,
            [line]: {
              ...prev[line],
              [stationKey]: !prev[line][stationKey]
            }
          }));
        };

        // Terminal station: has "arriving" and "departing" arrays
        // Middle station: has directional arrays (northbound/southbound or eastbound/westbound)
        const hasTrains = isTerminal
          ? (stationData.arriving?.length > 0 || stationData.departing?.length > 0)
          : Object.values(stationData).some(arr => arr?.length > 0);

        return (
          <div className={`mb-4 ${cardBg} rounded-xl border ${borderColor} overflow-hidden`}>
            {/* Station Header (Clickable) */}
            <button
              onClick={toggleExpand}
              className={`w-full px-4 py-3 flex items-center justify-between hover:opacity-80 transition-opacity ${isDarkMode ? 'bg-gray-800' : 'bg-gray-50'}`}
            >
              <div className="flex items-center gap-3">
                <span className="text-lg">{isExpanded ? '‚ñº' : '‚ñ∂'}</span>
                <h3 className={`text-lg font-bold ${textColor}`}>{stationName}</h3>
                {isTerminal && (
                  <span className={`text-xs px-2 py-1 rounded ${isDarkMode ? 'bg-blue-900 text-blue-300' : 'bg-blue-100 text-blue-800'}`}>
                    Terminal
                  </span>
                )}
              </div>
              {hasTrains && (
                <span className={`text-xs ${textMuted}`}>
                  {isTerminal
                    ? `${(stationData.arriving?.length || 0) + (stationData.departing?.length || 0)} trains`
                    : `${Object.values(stationData).flat().length} trains`}
                </span>
              )}
            </button>

            {/* Station Content (Expandable) */}
            {isExpanded && (
              <div className="p-4 space-y-4">
                {isTerminal ? (
                  <>
                    {/* Arriving Trains */}
                    {stationData.arriving && stationData.arriving.length > 0 && (
                      <div>
                        <div className={`flex items-center gap-2 mb-3 pb-2 border-b-2 ${isDarkMode ? 'border-green-700' : 'border-green-300'}`}>
                          <span className="text-xl">üöÜ</span>
                          <h4 className={`text-md font-bold ${isDarkMode ? 'text-green-300' : 'text-green-900'}`}>Arriving</h4>
                          <span className={`text-xs ${textMuted}`}>Train is arriving:</span>
                        </div>
                        <div className="space-y-3">
                          {stationData.arriving.map((train, idx) => renderTrainCard(train, idx, 'arrival'))}
                        </div>
                      </div>
                    )}

                    {/* Departing Trains */}
                    {stationData.departing && stationData.departing.length > 0 && (
                      <div>
                        <div className={`flex items-center gap-2 mb-3 pb-2 border-b-2 ${isDarkMode ? 'border-purple-700' : 'border-purple-300'}`}>
                          <span className="text-xl">üöÄ</span>
                          <h4 className={`text-md font-bold ${isDarkMode ? 'text-purple-300' : 'text-purple-900'}`}>Departing</h4>
                          <span className={`text-xs ${textMuted}`}>Departs for:</span>
                        </div>
                        <div className="space-y-3">
                          {stationData.departing.map((train, idx) => renderTrainCard(train, idx, 'departure'))}
                        </div>
                      </div>
                    )}

                    {!hasTrains && (
                      <div className={`p-6 text-center rounded-xl ${isDarkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                        <p className={textMuted}>No upcoming trains</p>
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    {/* Middle Station: Show directional trains */}
                    {Object.entries(stationData).map(([direction, trains]) => {
                      if (!trains || trains.length === 0) return null;

                      const directionColors = {
                        northbound: { border: 'border-purple-700', dark: 'border-purple-300', text: 'text-purple-300', textLight: 'text-purple-900' },
                        southbound: { border: 'border-orange-700', dark: 'border-orange-300', text: 'text-orange-300', textLight: 'text-orange-900' },
                        eastbound: { border: 'border-blue-700', dark: 'border-blue-300', text: 'text-blue-300', textLight: 'text-blue-900' },
                        westbound: { border: 'border-orange-700', dark: 'border-orange-300', text: 'text-orange-300', textLight: 'text-orange-900' }
                      };

                      const colors = directionColors[direction] || directionColors.northbound;
                      const borderColor = isDarkMode ? colors.border : colors.dark;
                      const textColor = isDarkMode ? colors.text : colors.textLight;

                      return (
                        <div key={direction}>
                          <div className={`flex items-center gap-2 mb-3 pb-2 border-b-2 ${borderColor}`}>
                            <span className="text-xl">‚Üí</span>
                            <h4 className={`text-md font-bold ${textColor}`}>
                              {direction.charAt(0).toUpperCase() + direction.slice(1)}
                            </h4>
                          </div>
                          <div className="space-y-3">
                            {trains.map((train, idx) => renderTrainCard(train, idx, 'arrival'))}
                          </div>
                        </div>
                      );
                    })}

                    {!hasTrains && (
                      <div className={`p-6 text-center rounded-xl ${isDarkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                        <p className={textMuted}>No upcoming trains</p>
                      </div>
                    )}
                  </>
                )}
              </div>
            )}
          </div>
        );
      };

      // Loading Screen Component
      if (isInitialLoad) {
        return (
          <div className={`min-h-screen flex items-center justify-center bg-gradient-to-br ${theme}`}>
            <div className="text-center px-4">
              <div className="mb-8">
                <h1 className={`text-4xl sm:text-5xl font-bold ${textColor} mb-2`}>
                  Taskify
                </h1>
                <p className={`text-xl ${isDarkMode ? 'text-blue-400' : 'text-blue-600'}`}>
                  Commute Dashboard
                </p>
              </div>

              {/* Loading Animation */}
              <div className="mb-6">
                <div className={`inline-block animate-spin rounded-full h-16 w-16 border-b-4 ${isDarkMode ? 'border-blue-500' : 'border-blue-600'} mb-4`}></div>
              </div>

              {/* Loading Status */}
              <div className={`space-y-2 ${textMuted}`}>
                <p className="text-sm">Loading your commute data...</p>
                <div className="flex justify-center gap-4 text-xs mt-4">
                  <span className={loading.weather ? 'opacity-50' : 'opacity-100'}>
                    {loading.weather ? '‚è≥' : '‚úì'} Weather
                  </span>
                  <span className={loading.drive ? 'opacity-50' : 'opacity-100'}>
                    {loading.drive ? '‚è≥' : '‚úì'} Routes
                  </span>
                  <span className={loading.transit ? 'opacity-50' : 'opacity-100'}>
                    {loading.transit ? '‚è≥' : '‚úì'} Transit
                  </span>
                </div>
                <p className="text-xs mt-4 opacity-70">
                  This may take up to 45 seconds on first load
                </p>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className={`min-h-screen bg-gradient-to-br ${theme} fade-in`}>
          <div className="max-w-6xl mx-auto content-area">
            {/* Header */}
            <div className={`${cardBg} shadow-lg p-4 sm:p-6 border-b ${borderColor} sticky top-0 z-40`}>
              <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                <div>
                  <h1 className={`text-2xl sm:text-3xl font-bold ${textColor} mb-1`}>
                    Taskify || Commute Dashboard
                  </h1>
                  <p className={`text-sm ${textMuted}`}>
                    {currentTime.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })} ‚Ä¢ {currentTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                  </p>
                  <p className={`text-base font-semibold mt-1 ${isDarkMode ? 'text-blue-400' : 'text-blue-600'}`}>
                    {greeting.timeGreeting} ‚Ä¢ {greeting.contextGreeting}
                  </p>
                </div>

                {/* Weather widget in header */}
                {weather && !weather._isFallback && (
                  <div className={`flex items-center gap-3 ${isDarkMode ? 'bg-gray-700' : 'bg-gray-100'} px-3 py-2 rounded-xl`}>
                    <img src={`https://openweathermap.org/img/wn/${weather.weather[0].icon}@2x.png`} alt={weather.weather[0].description} className="w-12 h-12" />
                    <div>
                      <p className={`text-2xl font-bold ${textColor}`}>{Math.round(weather.main.temp)}¬∞F</p>
                      <p className={`text-xs ${textMuted} capitalize`}>{weather.weather[0].description}</p>
                    </div>
                  </div>
                )}
              </div>

              {/* Controls */}
              <div className="flex flex-wrap gap-2 mt-3">
                <button
                  onClick={handleManualRefresh}
                  className={`px-3 py-1.5 text-sm rounded-lg font-medium transition-all ${
                    refreshSuccess
                      ? 'bg-green-600 text-white'
                      : isDarkMode ? 'bg-blue-600 hover:bg-blue-700 text-white' : 'bg-blue-500 hover:bg-blue-600 text-white'
                  }`}
                  aria-label="Refresh all data"
                >
                  {refreshSuccess ? '‚úì Refreshed' : 'üîÑ Refresh'}
                </button>

                <button
                  onClick={() => setIsDarkMode(!isDarkMode)}
                  className={`px-3 py-1.5 text-sm rounded-lg font-medium transition-all ${isDarkMode ? 'bg-yellow-500 text-gray-900 hover:bg-yellow-400' : 'bg-gray-800 text-white hover:bg-gray-700'}`}
                  aria-label={isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'}
                >
                  {isDarkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}
                </button>

                <div className={`px-3 py-1.5 rounded-lg ${isDarkMode ? 'bg-gray-700' : 'bg-gray-200'} ${textMuted} text-xs`}>
                  {lastRefresh.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                </div>
              </div>
            </div>

            {/* Content Area - Only show active section */}
            <div className="p-4 slide-in">
              {/* Drive Time Section */}
              {activeSection === 'drive' && (
                <div className={`${cardBg} rounded-2xl shadow-xl p-4 sm:p-6 border ${borderColor}`}>
                  <div className="flex items-center justify-between mb-4">
                    <h2 className={`text-xl sm:text-2xl font-bold ${textColor}`}>üöó Drive Times</h2>
                    <button
                      onClick={fetchDriveTimes}
                      className={`px-3 py-2 rounded-lg text-sm ${isDarkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
                      disabled={loading.drive}
                    >
                      {loading.drive ? '‚è≥' : 'üîÑ'}
                    </button>
                  </div>

                  {loading.drive && !driveData ? (
                    <div className="space-y-3">
                      {[1, 2, 3].map((i) => (
                        <div key={i} className={`p-4 rounded-xl ${isDarkMode ? 'skeleton-dark' : 'skeleton'} h-24`}></div>
                      ))}
                    </div>
                  ) : driveData && (
                    <>
                      {driveData._isFallback && (
                        <div className={`p-3 rounded-lg mb-4 ${isDarkMode ? 'bg-yellow-900 bg-opacity-30 text-yellow-300' : 'bg-yellow-100 text-yellow-800'}`}>
                          <p className="text-sm">‚ö†Ô∏è Using estimated times</p>
                        </div>
                      )}

                      <div className="flex items-center justify-between mb-4 flex-wrap gap-2">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <span className={`text-sm font-medium ${textColor}`}>Avoid Highways</span>
                          <div className="relative">
                            <input type="checkbox" checked={avoidHighways} onChange={(e) => setAvoidHighways(e.target.checked)} className="sr-only" />
                            <div className={`w-12 h-6 rounded-full transition-colors ${avoidHighways ? 'bg-green-500' : 'bg-gray-300'}`}>
                              <div className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform ${avoidHighways ? 'translate-x-6' : ''}`} />
                            </div>
                          </div>
                        </label>

                        <a
                          href={`https://www.google.com/maps/dir/${config.locations.home.lat},${config.locations.home.lng}/${config.locations.work.lat},${config.locations.work.lng}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className={`px-3 py-1.5 rounded-lg text-sm font-medium ${isDarkMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white`}
                        >
                          üó∫Ô∏è Maps
                        </a>
                      </div>

                      <div className="space-y-3">
                        <div className={`p-4 rounded-xl border-2 ${isDarkMode ? 'bg-orange-900 bg-opacity-30 border-orange-700' : 'bg-orange-50 border-orange-200'}`}>
                          <p className={`text-xs font-semibold mb-2 ${isDarkMode ? 'text-orange-400' : 'text-orange-800'}`}>üöó Home ‚Üí Garage</p>
                          <p className={`text-2xl font-bold ${isDarkMode ? 'text-orange-300' : 'text-orange-900'}`}>{formatDuration(Math.round(driveData.morning.duration.value / 60))}</p>
                          <p className={`text-sm ${isDarkMode ? 'text-orange-400' : 'text-orange-700'}`}>{driveData.morning.distance.text}</p>
                        </div>

                        <div className={`p-4 rounded-xl border-2 ${isDarkMode ? 'bg-blue-900 bg-opacity-30 border-blue-700' : 'bg-blue-50 border-blue-200'}`}>
                          <p className={`text-xs font-semibold mb-2 ${isDarkMode ? 'text-blue-400' : 'text-blue-800'}`}>üö∂ Garage ‚Üí Work</p>
                          <p className={`text-2xl font-bold ${isDarkMode ? 'text-blue-300' : 'text-blue-900'}`}>{formatDuration(Math.round(driveData.walk.duration.value / 60))}</p>
                          <p className={`text-sm ${isDarkMode ? 'text-blue-400' : 'text-blue-700'}`}>{driveData.walk.distance.text}</p>
                        </div>

                        <div className={`p-4 rounded-xl border-2 ${isDarkMode ? 'bg-purple-900 bg-opacity-30 border-purple-700' : 'bg-purple-50 border-purple-200'}`}>
                          <p className={`text-xs font-semibold mb-2 ${isDarkMode ? 'text-purple-400' : 'text-purple-800'}`}>üè† Garage ‚Üí Home</p>
                          <p className={`text-2xl font-bold ${isDarkMode ? 'text-purple-300' : 'text-purple-900'}`}>{formatDuration(Math.round(driveData.evening.duration.value / 60))}</p>
                          <p className={`text-sm ${isDarkMode ? 'text-purple-400' : 'text-purple-700'}`}>{driveData.evening.distance.text}</p>
                        </div>
                      </div>

                      <div className={`mt-4 p-3 rounded-lg ${isDarkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                        <p className={`text-sm ${textColor}`}>
                          <span className="font-semibold">Total: </span>
                          {Math.round(driveData.morning.duration.value / 60) + Math.round(driveData.walk.duration.value / 60)} min
                        </p>
                      </div>
                    </>
                  )}
                </div>
              )}

              {/* Transit Lines Section (N Line & G Line) */}
              {activeSection === 'nline' && (
                <div className="space-y-4">
                  {/* Line Visibility Toggles */}
                  <div className={`${cardBg} rounded-xl shadow-lg p-3 border ${borderColor}`}>
                    <div className="flex items-center gap-3 justify-between">
                      <span className={`text-sm font-semibold ${textColor}`}>Show Lines:</span>
                      <div className="flex gap-2">
                        <button
                          onClick={() => setVisibleLines(prev => ({ ...prev, nLine: !prev.nLine }))}
                          className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${
                            visibleLines.nLine
                              ? isDarkMode ? 'bg-purple-600 text-white' : 'bg-purple-500 text-white'
                              : isDarkMode ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-600'
                          }`}
                        >
                          N Line
                        </button>
                        <button
                          onClick={() => setVisibleLines(prev => ({ ...prev, gLine: !prev.gLine }))}
                          className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${
                            visibleLines.gLine
                              ? isDarkMode ? 'bg-orange-600 text-white' : 'bg-orange-500 text-white'
                              : isDarkMode ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-600'
                          }`}
                        >
                          G Line
                        </button>
                        <button
                          onClick={() => setVisibleLines(prev => ({ ...prev, bLine: !prev.bLine }))}
                          className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${
                            visibleLines.bLine
                              ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'
                              : isDarkMode ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-600'
                          }`}
                        >
                          B Line
                        </button>
                      </div>
                      <button
                        onClick={() => { fetchTransitData(); fetchGLineData(); fetchBLineData(); }}
                        className={`px-3 py-2 rounded-lg text-sm ${isDarkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
                        disabled={loading.transit || loading.gLine || loading.bLine}
                      >
                        {(loading.transit || loading.gLine || loading.bLine) ? '‚è≥' : 'üîÑ'}
                      </button>
                    </div>
                  </div>

                  {/* Expand/Collapse All Controls */}
                  <div className={`${cardBg} rounded-xl shadow-lg p-3 border ${borderColor}`}>
                    <div className="flex items-center gap-3 justify-between">
                      <span className={`text-sm font-semibold ${textColor}`}>Station Cards:</span>
                      <div className="flex gap-2">
                        <button
                          onClick={() => setExpandedStations({
                            nLine: { terminal124th: true, station112th: true, unionStation: true },
                            gLine: { oldeTown: true, goldStrike: true, pecosJunction: true, unionStation: true },
                            bLine: { westminster: true, pecosJunction: true, unionStation: true }
                          })}
                          className={`px-3 py-1.5 rounded-lg text-xs font-medium ${isDarkMode ? 'bg-green-700 hover:bg-green-600 text-white' : 'bg-green-500 hover:bg-green-600 text-white'} transition-all`}
                        >
                          ‚ñº Expand All
                        </button>
                        <button
                          onClick={() => setExpandedStations({
                            nLine: { terminal124th: false, station112th: false, unionStation: false },
                            gLine: { oldeTown: false, goldStrike: false, pecosJunction: false, unionStation: false },
                            bLine: { westminster: false, pecosJunction: false, unionStation: false }
                          })}
                          className={`px-3 py-1.5 rounded-lg text-xs font-medium ${isDarkMode ? 'bg-red-700 hover:bg-red-600 text-white' : 'bg-red-500 hover:bg-red-600 text-white'} transition-all`}
                        >
                          ‚ñ∂ Collapse All
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* N Line Card with Station-based Layout */}
                  {visibleLines.nLine && (
                    <div className={`${cardBg} rounded-2xl shadow-xl p-4 sm:p-6 border ${borderColor}`}>
                      <div className="flex items-center justify-between mb-6">
                        <h2 className={`text-xl sm:text-2xl font-bold ${textColor}`}>üöÜ N Line</h2>
                      </div>

                      {/* Linear Route Visualization */}
                      <div className="mb-6">
                        <div className={`p-4 rounded-xl ${isDarkMode ? 'bg-gray-800' : 'bg-gray-50'}`}>
                          <div className="flex items-center justify-between mb-2">
                            <span className={`text-xs font-semibold ${textMuted}`}>NORTH</span>
                            <span className={`text-xs font-semibold ${textMuted}`}>SOUTH</span>
                          </div>

                          {/* Route Line */}
                          <div className="relative flex items-center justify-between py-3">
                            {/* 124th Avenue */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-purple-500' : 'bg-purple-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(nLineData.terminal124th, true);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>124th<br/>Ave</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-purple-500' : 'bg-purple-600'}`}></div>

                            {/* 112th Station (Highlighted) */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-4 h-4 rounded-full ${isDarkMode ? 'bg-purple-400' : 'bg-purple-500'} border-4 ${isDarkMode ? 'border-purple-600' : 'border-purple-700'} shadow-lg ${(() => {
                                const glow = getStationGlow(nLineData.station112th, false);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 font-bold ${isDarkMode ? 'text-purple-300' : 'text-purple-900'} text-center`}>112th<br/>Stn</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-purple-500' : 'bg-purple-600'}`}></div>

                            {/* Union Station */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-purple-500' : 'bg-purple-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(nLineData.unionStation, true);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>Union<br/>Stn</span>
                            </div>
                          </div>

                          <div className={`mt-2 p-2 rounded-lg ${isDarkMode ? 'bg-purple-900 bg-opacity-20' : 'bg-purple-50'}`}>
                            <p className={`text-xs text-center ${isDarkMode ? 'text-purple-300' : 'text-purple-800'}`}>
                              üìç Boarding at 112th Station
                            </p>
                          </div>
                        </div>
                      </div>

                      {/* Station Cards */}
                      <div className="space-y-0">
                        {renderStationCard('124th Avenue Station', nLineData.terminal124th, 'nLine', 'terminal124th', true)}
                        {renderStationCard('112th Avenue Station', nLineData.station112th, 'nLine', 'station112th', false)}
                        {renderStationCard('Union Station', nLineData.unionStation, 'nLine', 'unionStation', true)}
                      </div>

                      <div className={`mt-4 p-3 rounded-lg ${isDarkMode ? 'bg-blue-900 bg-opacity-30' : 'bg-blue-50'}`}>
                        <p className={`text-xs ${isDarkMode ? 'text-blue-300' : 'text-blue-800'}`}>
                          üî¥ Live RTD data ‚Ä¢ Updates every minute
                        </p>
                      </div>
                    </div>
                  )}

                  {/* G Line Card with Station-based Layout */}
                  {visibleLines.gLine && (
                    <div className={`${cardBg} rounded-2xl shadow-xl p-4 sm:p-6 border ${borderColor}`}>
                      <div className="flex items-center justify-between mb-6">
                        <h2 className={`text-xl sm:text-2xl font-bold ${textColor}`}>üöÜ G Line</h2>
                      </div>

                      {/* Linear Route Visualization */}
                      <div className="mb-6">
                        <div className={`p-4 rounded-xl ${isDarkMode ? 'bg-gray-800' : 'bg-gray-50'}`}>
                          <div className="flex items-center justify-between mb-2">
                            <span className={`text-xs font-semibold ${textMuted}`}>WEST</span>
                            <span className={`text-xs font-semibold ${textMuted}`}>EAST</span>
                          </div>

                          {/* Route Line */}
                          <div className="relative flex items-center justify-between py-3">
                            {/* Olde Town */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-orange-500' : 'bg-orange-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(gLineData.oldeTown, true);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>Olde<br/>Town</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-orange-500' : 'bg-orange-600'}`}></div>

                            {/* Gold Strike (Highlighted) */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-4 h-4 rounded-full ${isDarkMode ? 'bg-orange-400' : 'bg-orange-500'} border-4 ${isDarkMode ? 'border-orange-600' : 'border-orange-700'} shadow-lg ${(() => {
                                const glow = getStationGlow(gLineData.goldStrike, false);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 font-bold ${isDarkMode ? 'text-orange-300' : 'text-orange-900'} text-center`}>Gold<br/>Strike</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-orange-500' : 'bg-orange-600'}`}></div>

                            {/* Pecos Junction */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-orange-500' : 'bg-orange-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(gLineData.pecosJunction, false);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>Pecos<br/>Jct</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-orange-500' : 'bg-orange-600'}`}></div>

                            {/* Union Station */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-orange-500' : 'bg-orange-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(gLineData.unionStation, true);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>Union<br/>Stn</span>
                            </div>
                          </div>

                          <div className={`mt-2 p-2 rounded-lg ${isDarkMode ? 'bg-orange-900 bg-opacity-20' : 'bg-orange-50'}`}>
                            <p className={`text-xs text-center ${isDarkMode ? 'text-orange-300' : 'text-orange-800'}`}>
                              üìç Boarding at Gold Strike
                            </p>
                          </div>
                        </div>
                      </div>

                      {/* Station Cards */}
                      <div className="space-y-0">
                        {renderStationCard('Olde Town Arvada', gLineData.oldeTown, 'gLine', 'oldeTown', true)}
                        {renderStationCard('Gold Strike Station', gLineData.goldStrike, 'gLine', 'goldStrike', false)}
                        {renderStationCard('Pecos Junction', gLineData.pecosJunction, 'gLine', 'pecosJunction', false)}
                        {renderStationCard('Union Station', gLineData.unionStation, 'gLine', 'unionStation', true)}
                      </div>

                      <div className={`mt-4 p-3 rounded-lg ${isDarkMode ? 'bg-blue-900 bg-opacity-30' : 'bg-blue-50'}`}>
                        <p className={`text-xs ${isDarkMode ? 'text-blue-300' : 'text-blue-800'}`}>
                          üî¥ Live RTD data ‚Ä¢ Updates every minute
                        </p>
                      </div>
                    </div>
                  )}

                  {/* B Line Card with Station-based Layout */}
                  {visibleLines.bLine && (
                    <div className={`${cardBg} rounded-2xl shadow-xl p-4 sm:p-6 border ${borderColor}`}>
                      <div className="flex items-center justify-between mb-6">
                        <h2 className={`text-xl sm:text-2xl font-bold ${textColor}`}>üöÜ B Line</h2>
                      </div>

                      {/* Linear Route Visualization */}
                      <div className="mb-6">
                        <div className={`p-4 rounded-xl ${isDarkMode ? 'bg-gray-800' : 'bg-gray-50'}`}>
                          <div className="flex items-center justify-between mb-2">
                            <span className={`text-xs font-semibold ${textMuted}`}>SOUTH</span>
                            <span className={`text-xs font-semibold ${textMuted}`}>NORTH</span>
                          </div>

                          {/* Route Line - Only 3 stops */}
                          <div className="relative flex items-center justify-between py-3">
                            {/* Union Station */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-blue-500' : 'bg-blue-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(bLineData.unionStation, true);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>Union<br/>Stn</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-blue-500' : 'bg-blue-600'}`}></div>

                            {/* Pecos Junction (Highlighted - Boarding Point) */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-4 h-4 rounded-full ${isDarkMode ? 'bg-blue-400' : 'bg-blue-500'} border-4 ${isDarkMode ? 'border-blue-600' : 'border-blue-700'} shadow-lg ${(() => {
                                const glow = getStationGlow(bLineData.pecosJunction, false);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 font-bold ${isDarkMode ? 'text-blue-300' : 'text-blue-900'} text-center`}>Pecos<br/>Jct</span>
                            </div>
                            <div className={`flex-1 h-0.5 ${isDarkMode ? 'bg-blue-500' : 'bg-blue-600'}`}></div>

                            {/* Westminster */}
                            <div className="flex flex-col items-center flex-1">
                              <div className={`w-3 h-3 rounded-full ${isDarkMode ? 'bg-blue-500' : 'bg-blue-600'} border-2 ${isDarkMode ? 'border-gray-700' : 'border-white'} ${(() => {
                                const glow = getStationGlow(bLineData.westminster, true);
                                return glow.glow ? (glow.type === 'arriving' ? 'station-glow-arriving' : 'station-glow-departing') : '';
                              })()}`}></div>
                              <span className={`text-xs mt-1 ${textMuted} text-center`}>West-<br/>minster</span>
                            </div>
                          </div>

                          <div className={`mt-2 p-2 rounded-lg ${isDarkMode ? 'bg-blue-900 bg-opacity-20' : 'bg-blue-50'}`}>
                            <p className={`text-xs text-center ${isDarkMode ? 'text-blue-300' : 'text-blue-800'}`}>
                              üìç Boarding at Pecos Junction
                            </p>
                          </div>
                        </div>
                      </div>

                      {/* Station Cards */}
                      <div className="space-y-0">
                        {renderStationCard('Westminster Station', bLineData.westminster, 'bLine', 'westminster', true)}
                        {renderStationCard('Pecos Junction', bLineData.pecosJunction, 'bLine', 'pecosJunction', false)}
                        {renderStationCard('Union Station', bLineData.unionStation, 'bLine', 'unionStation', true)}
                      </div>

                      <div className={`mt-4 p-3 rounded-lg ${isDarkMode ? 'bg-blue-900 bg-opacity-30' : 'bg-blue-50'}`}>
                        <p className={`text-xs ${isDarkMode ? 'text-blue-300' : 'text-blue-800'}`}>
                          üî¥ Live RTD data ‚Ä¢ Updates every minute
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Bus Schedule Section */}
              {activeSection === 'bus' && (
                <div className={`${cardBg} rounded-2xl shadow-xl p-4 sm:p-6 border ${borderColor}`}>
                  <div className="flex items-center gap-2 mb-4">
                    <span className="text-2xl">üöå</span>
                    <h2 className={`text-xl sm:text-2xl font-bold ${textColor}`}>Downtown Shuttle</h2>
                  </div>

                  <div className={`p-4 rounded-xl mb-4 ${isDarkMode ? 'bg-blue-900 bg-opacity-30' : 'bg-blue-50'}`}>
                    <p className={`font-semibold mb-3 text-base ${isDarkMode ? 'text-blue-300' : 'text-blue-900'}`}>üöå Available Shuttle Services</p>

                    <div className={`space-y-4 text-sm ${isDarkMode ? 'text-blue-200' : 'text-blue-800'}`}>
                      <div>
                        <p className="font-semibold text-base mb-2">16th Street FreeRide</p>
                        <ul className="space-y-1 pl-4">
                          <li>‚Ä¢ Free shuttle every ~5 minutes</li>
                          <li>‚Ä¢ Route: 16th Street Mall</li>
                          <li>‚Ä¢ Hours: 5:30 AM - 12:30 AM daily</li>
                          <li>‚Ä¢ Connects Union Station ‚Üî Civic Center</li>
                          <li>‚Ä¢ Walk from Union Station: 4-7 minutes</li>
                        </ul>
                      </div>

                      <div className={`pt-3 border-t ${isDarkMode ? 'border-blue-700' : 'border-blue-300'}`}>
                        <p className="font-semibold text-base mb-2">MetroRide - Civic Center Station</p>
                        <ul className="space-y-1 pl-4">
                          <li>‚Ä¢ Free downtown circulator bus</li>
                          <li>‚Ä¢ Route: Civic Center ‚Üî Union Station</li>
                          <li>‚Ä¢ Hours: Weekdays 6:30 AM - 7:00 PM</li>
                          <li>‚Ä¢ Frequency: Every 5-10 minutes</li>
                          <li>‚Ä¢ Stops near 16th Street Mall</li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                    <p className={`text-xs ${textMuted}`}>
                      ‚ÑπÔ∏è Both services are FREE and connect Union Station to downtown Denver
                    </p>
                  </div>
                </div>
              )}

              {/* Search Locator Section */}
              {activeSection === 'search' && (
                <div className={`${cardBg} rounded-2xl shadow-xl p-4 sm:p-6 border ${borderColor}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold ${textColor} mb-4`}>üîç Search Drive Times</h2>

                  <form
                    onSubmit={(e) => {
                      e.preventDefault();
                      if (searchFromAddress && searchToAddress && !loading.search) {
                        searchDriveTimes();
                      }
                    }}
                    className="space-y-3 mb-4"
                  >
                    <div>
                      <label htmlFor="from-address" className={`block text-sm font-medium ${textColor} mb-1`}>From Address</label>
                      <input
                        id="from-address"
                        type="text"
                        value={searchFromAddress}
                        onChange={(e) => setSearchFromAddress(e.target.value)}
                        placeholder="123 Main St, Denver, CO"
                        aria-label="Starting address"
                        className={`w-full px-3 py-2 rounded-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'}`}
                      />
                    </div>

                    <div>
                      <label htmlFor="to-address" className={`block text-sm font-medium ${textColor} mb-1`}>To Address</label>
                      <input
                        id="to-address"
                        type="text"
                        value={searchToAddress}
                        onChange={(e) => setSearchToAddress(e.target.value)}
                        placeholder="456 Market St, Denver, CO"
                        aria-label="Destination address"
                        className={`w-full px-3 py-2 rounded-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'}`}
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={!searchFromAddress || !searchToAddress || loading.search}
                      className={`w-full px-4 py-2.5 rounded-lg font-semibold ${
                        !searchFromAddress || !searchToAddress || loading.search
                          ? 'bg-gray-400 cursor-not-allowed'
                          : isDarkMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'
                      } text-white transition-all`}
                      aria-label="Search drive times"
                    >
                      {loading.search ? 'Searching...' : 'üîç Search'}
                    </button>
                  </form>

                  {searchResults && (
                    <div className="space-y-3">
                      {searchResults.error ? (
                        <div className={`p-4 rounded-lg ${isDarkMode ? 'bg-red-900 bg-opacity-30 text-red-300' : 'bg-red-50 text-red-800'}`}>
                          <p className="text-sm">{searchResults.error}</p>
                        </div>
                      ) : (
                        <>
                          <div className={`p-4 rounded-xl border-2 ${isDarkMode ? 'bg-green-900 bg-opacity-30 border-green-700' : 'bg-green-50 border-green-200'}`}>
                            <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-green-400' : 'text-green-800'}`}>üõ£Ô∏è With Highway</p>
                            <p className={`text-xl font-bold ${isDarkMode ? 'text-green-300' : 'text-green-900'}`}>{formatDuration(searchResults.withHighway.durationMinutes)}</p>
                            <p className={`text-sm ${isDarkMode ? 'text-green-400' : 'text-green-700'}`}>{searchResults.withHighway.distance}</p>
                          </div>

                          <div className={`p-4 rounded-xl border-2 ${isDarkMode ? 'bg-blue-900 bg-opacity-30 border-blue-700' : 'bg-blue-50 border-blue-200'}`}>
                            <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-blue-400' : 'text-blue-800'}`}>üöó Without Highway</p>
                            <p className={`text-xl font-bold ${isDarkMode ? 'text-blue-300' : 'text-blue-900'}`}>{formatDuration(searchResults.noHighway.durationMinutes)}</p>
                            <p className={`text-sm ${isDarkMode ? 'text-blue-400' : 'text-blue-700'}`}>{searchResults.noHighway.distance}</p>
                          </div>
                        </>
                      )}
                    </div>
                  )}

                  <div className={`mt-4 p-3 rounded-lg ${isDarkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                    <p className={`text-xs ${textMuted} mb-2 font-semibold`}>Quick Locations:</p>
                    <div className="grid grid-cols-2 gap-2 text-xs">
                      <button
                        onClick={() => setSearchFromAddress('104th Ave & Washington St, Northglenn, CO')}
                        className={`px-2 py-1 rounded ${isDarkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'}`}
                      >
                        Home
                      </button>
                      <button
                        onClick={() => setSearchFromAddress('Union Station, Denver, CO')}
                        className={`px-2 py-1 rounded ${isDarkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'}`}
                      >
                        Garage
                      </button>
                      <button
                        onClick={() => setSearchToAddress('Union Station, Denver, CO')}
                        className={`px-2 py-1 rounded ${isDarkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'}`}
                      >
                        Garage
                      </button>
                      <button
                        onClick={() => setSearchToAddress('1700 Broadway, Denver, CO')}
                        className={`px-2 py-1 rounded ${isDarkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'}`}
                      >
                        Work
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* Footer info */}
            <div className={`text-center py-4 ${textMuted}`}>
              <p className="text-xs">Auto-refresh: 15 min (Transit: 1 min)</p>
            </div>
          </div>

          {/* Bottom Navigation Bar */}
          <nav className={`bottom-nav ${cardBg} border-t ${borderColor} shadow-lg`} aria-label="Main navigation" role="navigation">
            <div className="max-w-6xl mx-auto px-2 py-3">
              <div className="flex justify-around items-center" role="tablist">
                <button
                  onClick={() => setActiveSection('drive')}
                  className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${
                    activeSection === 'drive'
                      ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'
                      : textMuted
                  }`}
                  aria-label="Drive times section"
                  aria-current={activeSection === 'drive' ? 'page' : undefined}
                >
                  <span className="text-2xl" aria-hidden="true">üöó</span>
                  <span className="text-xs font-medium">Drive</span>
                </button>

                <button
                  onClick={() => setActiveSection('nline')}
                  className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${
                    activeSection === 'nline'
                      ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'
                      : textMuted
                  }`}
                  aria-label="Rail transit schedule section"
                  aria-current={activeSection === 'nline' ? 'page' : undefined}
                >
                  <span className="text-2xl" aria-hidden="true">üöÜ</span>
                  <span className="text-xs font-medium">Transit</span>
                </button>

                <button
                  onClick={() => setActiveSection('bus')}
                  className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${
                    activeSection === 'bus'
                      ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'
                      : textMuted
                  }`}
                  aria-label="Bus schedule section"
                  aria-current={activeSection === 'bus' ? 'page' : undefined}
                >
                  <span className="text-2xl" aria-hidden="true">üöå</span>
                  <span className="text-xs font-medium">Bus</span>
                </button>

                <button
                  onClick={() => setActiveSection('search')}
                  className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${
                    activeSection === 'search'
                      ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'
                      : textMuted
                  }`}
                  aria-label="Search locator section"
                  aria-current={activeSection === 'search' ? 'page' : undefined}
                >
                  <span className="text-2xl" aria-hidden="true">üîç</span>
                  <span className="text-xs font-medium">Search</span>
                </button>
              </div>
            </div>
          </nav>
        </div>
      );
    };

    ReactDOM.render(<CommuteDashboard />, document.getElementById('root'));
  </script>
</body>
</html>
